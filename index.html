<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>ContAIbil ‚Äì Workspace Fatture</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#FFFFFF" />
  
  <!-- COLLEGAMENTO CSS -->
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="loadingOverlay" class="loading-overlay hidden">
    <div class="loading-box">
      <div class="spinner"></div>
      <div id="loadingText" class="loading-text">Elaborazione in corso...</div>
      <div class="loading-progress-bar">
        <div id="loadingProgress" class="loading-progress-fill"></div>
      </div>
    </div>
  </div>
  <div class="app-container">
    <!-- HEADER -->
    <div class="topbar">
      <div class="topbar-main">
        <div class="topbar-left">
          <!-- Logo CA -->
          <div class="app-logo">
            <div class="app-logo-inner">CA</div>
          </div>
          <!-- Titoli -->
          <div class="topbar-titles">
            <div class="app-name">ContAIbil</div>
            <div class="section-title">
              <span>Riconciliazione ADE / Gestionale</span>
            </div>
            <div class="section-subtitle">
              Match fatture acquisto, note credito e quadrature periodiche
            </div>
          </div>
        </div>
        <div class="topbar-right">
          <button id="btnWideMode" class="btn-topbar-icon" title="Passare a modalit√† a schermo intero (nascondi sidebar)">
            <span>‚õ∂</span>
          </button>
          <button id="btnCompactMode" class="btn-topbar-icon" title="Attiva vista compatta (tipo Excel)">
            <span>üóã</span>
          </button>
          <div class="pill-env">
            <span class="pill-dot"></span>
            <span>Workspace Fatture Acquisto</span>
          </div>
        </div>
      </div>

      <!-- Nav sezioni -->
      <div class="topbar-nav">
        <button class="nav-tab main-tab-label active" data-section="section-recon">
          <span class="nav-pill">‚óè</span>
          Riconciliazione Acquisti
        </button>
        <button class="nav-tab" data-section="section-sales">
          <span class="nav-pill">üÜï</span>
          Riconciliazione Vendite (Beta)
        </button>
        <button class="nav-tab" data-section="section-analysis">
          Analisi fornitori (ADE)
        </button>
        <button class="nav-tab" data-section="section-dashboard">
          Dashboard / KPI
        </button>
        <button class="nav-tab" data-section="section-vat">
          Liquidazione IVA (ADE)
        </button>
      </div>
    </div>

    

    <!-- SEZIONI -->
    <div class="sections-wrapper">
      <!-- SEZIONE 1: RICONCILIAZIONE -->
      <div class="section active" id="section-recon">
        <div class="main">
          <!-- SIDE COLUMN: FILE INPUTS -->
          <div class="col-side">
            <!-- QUICK START GUIDE -->
            <details class="card quickstart-card" open>
              <summary class="card-header quickstart-header">
                <div>
                  <div class="card-title">
                    <span class="emoji">üöÄ</span>
                    Guida rapida - 5 step
                  </div>
                </div>
              </summary>
              <div class="quickstart-body">
                <ol class="quickstart-list">
                  <li><strong>Carica i file</strong> ‚Äî Trascina CSV/XLSX di ADE (A) e Gestionale (B)</li>
                  <li><strong>Verifica il mapping</strong> ‚Äî Controlla che le colonne siano giuste</li>
                  <li><strong>Confronta fatture</strong> ‚Äî Clicca "Confronta fatture" per matchare</li>
                  <li><strong>Rivedi i risultati</strong> ‚Äî Correggi manualmente gli errori nella tabella</li>
                  <li><strong>Esporta</strong> ‚Äî Scarica il CSV riconciliato</li>
                </ol>
                <div class="quickstart-tip">üí° <strong>Tip:</strong> Clicca sui numeri dello stepper per navigare tra le sezioni</div>
              </div>
            </details>

            <div class="card">
              <div class="card-header">
                <div>
                  <div class="card-title">
                    <span class="emoji">üìÅ</span>
                    File A ¬∑ ADE
                  </div>
                  <div class="card-subtitle">CSV/XLSX export fatture acquisto da portale ADE</div>
                </div>
                <div class="badge-soft">Obbligatorio</div>
              </div>
              <div class="file-block">
                <label for="fileA">Seleziona il file ADE (CSV o XLSX)</label>
                  <input id="fileA" type="file"
                    accept=".csv,.xlsx,.xml,text/csv,text/xml,application/xml,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" />
                <div class="file-hint">üí° <strong>Multi-file:</strong> oppure seleziona una cartella con pi√π export (mesi/trimestri)</div>
                <label for="folderA">Seleziona cartella ADE (tutti i file saranno uniti)</label>
                  <input id="folderA" type="file" webkitdirectory multiple
                    accept=".csv,.xlsx,.xml" />
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <div>
                  <div class="card-title">
                    <span class="emoji">üè∑Ô∏è</span>
                    File B ¬∑ Gestionale Fatture
                  </div>
                  <div class="card-subtitle">CSV/XLSX fatture acquisto (Contel / Mexal)</div>
                </div>
                <div class="badge-soft">Obbligatorio</div>
              </div>
              <div class="file-block">
                <label for="fileB">Seleziona file fatture acquisto</label>
                  <input id="fileB" type="file"
                    accept=".csv,.xlsx,.xml,text/csv,text/xml,application/xml,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" />
                <div class="file-hint">üí° <strong>Multi-file:</strong> oppure seleziona una cartella con pi√π export (mesi/trimestri)</div>
                <label for="folderB">Seleziona cartella Gestionale (tutti i file saranno uniti)</label>
                  <input id="folderB" type="file" webkitdirectory multiple
                    accept=".csv,.xlsx,.xml" />
                <button type="button" id="btnForceMapB" class="btn btn-tertiary btn-force-map" title="Forza la scelta delle colonne per questo file">
                  Forza mapping colonne
                </button>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <div>
                  <div class="card-title">
                    <span class="emoji">‚Ü©Ô∏è</span>
                    File C ¬∑ Note Credito
                  </div>
                  <div class="card-subtitle">CSV/XLSX note di credito acquisto da gestionale</div>
                </div>
                <div class="badge-soft">Opzionale</div>
              </div>
              <div class="file-block">
                <label for="fileC">Seleziona file note credito (se disponibile)</label>
                  <input id="fileC" type="file"
                    accept=".csv,.xlsx,.xml,text/csv,text/xml,application/xml,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" />
                <div class="file-hint">üí° <strong>Multi-file:</strong> oppure seleziona una cartella con pi√π export (mesi/trimestri)</div>
                <label for="folderC">Seleziona cartella Note Credito (tutti i file saranno uniti)</label>
                  <input id="folderC" type="file" webkitdirectory multiple
                    accept=".csv,.xlsx,.xml" />
                <button type="button" id="btnForceMapC" class="btn btn-tertiary btn-force-map" title="Forza la scelta delle colonne per questo file">
                  Forza mapping colonne
                </button>
              </div>
            </div>
            <!-- CARD ¬∑ APPRENDIMENTO CONTAIBIL (COLLASSABILE) -->
    <details class="card learning-card">
      <summary class="card-header learning-card-summary">
        <div>
          <div class="card-title learning-title-row">
            <span class="emoji">‚öôÔ∏è</span>
            <span>Impostazioni avanzate</span>
            <span class="learning-dot"></span>
          </div>
          <div class="card-subtitle">
            Procedure azienda / Apprendimento (Procedure che ContAIbil impara automaticamente)
          </div>
        </div>
        <div class="badge-soft learning-badge">Auto-learning</div>
      </summary>

      <div class="learning-body">
        <textarea
          id="learningCodeBox"
          class="learning-textarea"
          placeholder="// Qui compariranno le regole apprese automaticamente
// Esempio: mapping numeri documento, denominazioni particolari, arrotondamenti..."
        ></textarea>

        <div class="learning-buttons-row">
          <button type="button" id="btnViewCode" class="btn btn-secondary learning-btn">
            üëÅÔ∏è Nascondi Codice
          </button>
          <button type="button" id="btnSaveProcedures" class="btn btn-secondary learning-btn">
            üíæ Salva procedure
          </button>
          <button type="button" id="btnLoadProcedures" class="btn btn-tertiary learning-btn">
            üìÇ Carica procedure
          </button>
          <input type="file" id="fileProcedures" accept=".json" style="display:none;" />
        </div>

        <div class="learning-hint">
          ContAIbil crea nuove regole quando trasformi un MATCH_FIX in MATCH OK
          o quando sistemi manualmente un abbinamento ADE / Gestionale.
          Puoi esportare il file JSON e riutilizzarlo su altri clienti o periodi.
        </div>
      </div>
    </details> <!-- fine learning-card -->
  </div> <!-- fine col-side -->

          <!-- MAIN COLUMN: ACTIONS + TABLE -->
          <div class="col-main">
            <div class="card">
              <div class="flow-stepper" id="flowStepper">
                <div class="flow-step disabled" data-step="1">
                  <div class="flow-step-circle">1</div>
                  <div class="flow-step-text">
                    <div class="flow-step-title">Carica file</div>
                    <div class="flow-step-desc">Carica ADE (A) e Gestionale (B)</div>
                  </div>
                </div>
                <div class="flow-step disabled" data-step="2">
                  <div class="flow-step-circle">2</div>
                  <div class="flow-step-text">
                    <div class="flow-step-title">Verifica / Mapping colonne</div>
                    <div class="flow-step-desc">Conferma le colonne richieste</div>
                  </div>
                </div>
                <div class="flow-step disabled" data-step="3">
                  <div class="flow-step-circle">3</div>
                  <div class="flow-step-text">
                    <div class="flow-step-title">Confronta fatture</div>
                    <div class="flow-step-desc">Esegui il match guidato</div>
                  </div>
                </div>
                <div class="flow-step disabled" data-step="4">
                  <div class="flow-step-circle">4</div>
                  <div class="flow-step-text">
                    <div class="flow-step-title">Correggi / Conferma</div>
                    <div class="flow-step-desc">Rivedi i match proposti</div>
                  </div>
                </div>
                <div class="flow-step disabled" data-step="5">
                  <div class="flow-step-circle">5</div>
                  <div class="flow-step-text">
                    <div class="flow-step-title">Esporta risultati</div>
                    <div class="flow-step-desc">Scarica i file di sintesi</div>
                  </div>
                </div>
              </div>

               <div class="actions-row">
                 <div class="actions-left">
                   <button id="btnMatch" class="btn btn-primary">
                     <span class="btn-icon">‚öôÔ∏è</span>
                     Confronta fatture
                   </button>
                 </div>
                 
                 <div class="actions-right">
                   <button id="btnUndoDelete" class="btn btn-tertiary" disabled>
                     Annulla ultima azione
                   </button>
                   <button id="btnResetAll" class="btn btn-tertiary" disabled>
                     Ripristina tutto
                   </button>
                   <span id="statusText" class="status-text">Nessun confronto eseguito.</span>
                 </div>
               </div>
 
              <div class="summary" id="summaryRow" style="display:none;">
                <div class="chip">
                  <span class="chip-dot dot-green"></span>
                  Match OK: <span id="cntOk">0</span>
                </div>
                <div class="chip">
                  <span class="chip-dot dot-yellow"></span>
                  Match da correggere: <span id="cntFix">0</span>
                </div>
                <div class="chip">
                  <span class="chip-dot dot-red"></span>
                  Solo ADE: <span id="cntAde">0</span>
                </div>
                <div class="chip">
                  <span class="chip-dot dot-blue"></span>
                  Solo Gestionale: <span id="cntGest">0</span>
                </div>
              </div>

              <!-- Box copertura periodo -->
              <div class="period-row" id="periodRow">
                <div class="period-blocks">
                  <div class="period-title">Copertura periodo</div>
                  <div class="period-line">
                    <span class="period-label">ADE:</span>
                    <span class="period-value" id="periodAde">n/d</span>
                  </div>
                  <div class="period-line">
                    <span class="period-label">Gestionale:</span>
                    <span class="period-value" id="periodGest">n/d</span>
                  </div>
                </div>
                <div class="period-status">
                  <div id="periodStatusBadge" class="period-badge period-badge-soft">
                    ‚ÑπÔ∏è In attesa
                  </div>
                  <div id="periodStatusText" class="period-status-text">
                    Carica i file ADE e gestionale e lancia il confronto per vedere la copertura reale.
                  </div>
                </div>
              </div>
            </div>

            <div class="table-card">
              <div class="table-header">
                 <div>
                   <div class="table-title">Risultato riconciliazione</div>
                   <div class="table-subtitle">Vista combinata ADE / Gestionale</div>
                 </div>
                 <button id="btnToggleExpand" class="btn btn-tertiary btn-icon-only" title="Allarga/Stringi Tabella">
                   ‚§¢ Modalit√† Estesa
                 </button>
               </div>

              <!-- TOOLBAR STICKY: FILTRI + EXPORT -->
              <div class="table-toolbar" id="tableToolbar" style="display:none;">
                <!-- Export buttons -->
                <div class="toolbar-section export-section">
                  <div class="export-label">Esportazioni:</div>
                  <button id="btnExportFiltered" class="btn btn-secondary btn-highlight" disabled title="Esporta solo le righe attualmente visibili in tabella (filtrate)">
                    <span class="btn-icon">üëÅÔ∏è</span>
                    VISTA ATTUALE
                  </button>
                  <div class="vr-separator"></div>
                  <button id="btnExportAll" class="btn btn-tertiary" disabled>Tutti</button>
                  <button id="btnExportAde" class="btn btn-tertiary" disabled>Solo ADE</button>
                  <button id="btnExportGest" class="btn btn-tertiary" disabled>Solo Gest</button>
                  <button id="btnExportFix" class="btn btn-tertiary" disabled>Solo Fix</button>
                </div>

                <!-- Filtri stato -->
                <div class="toolbar-section filter-section">
                  <div class="filter-row" id="filterRow">
                    <button class="filter-btn active" data-filter="ALL">Tutti</button>
                    <button class="filter-btn" data-filter="MATCH_OK">Match OK</button>
                    <button class="filter-btn" data-filter="MATCH_FIX">Da correggere</button>
                    <button class="filter-btn" data-filter="SOLO_ADE">Solo ADE</button>
                    <button class="filter-btn" data-filter="SOLO_GEST">Solo Gestionale</button>
                  </div>
                </div>

                <!-- Filtri avanzati -->
                <div class="toolbar-section advanced-filter-section">
                  <div class="advanced-filter-row" id="advancedFilterRow">
                    <div style="font-size:12px; opacity:0.8;">Filtri aggiuntivi:</div>

                    <!-- Filtro mese ADE -->
                    <div>
                      <label for="monthFilter" style="font-size:12px; opacity:0.8; display:block;">Mese (data ADE)</label>
                      <select id="monthFilter" style="min-width: 200px; padding:4px 8px; border-radius:6px; border:1px solid rgba(148,163,184,0.4); background:var(--sys-bg-shell); color:var(--sys-text-primary);">
                        <option value="">Tutti i mesi ADE</option>
                      </select>
                    </div>

                    <!-- Filtro fornitore -->
                    <div>
                      <label for="supplierFilterInput" style="font-size:12px; opacity:0.8; display:block;">Fornitore (denominazione o P.IVA)</label>
                      <input id="supplierFilterInput"
                            type="text"
                            placeholder="Es. WIND, 1337820152..."
                            style="min-width: 240px; padding:4px 8px; border-radius:6px; border:1px solid rgba(148,163,184,0.4); background:var(--sys-bg-shell); color:var(--sys-text-primary);">
                    </div>

                    <!-- Filtro numero fattura -->
                    <div>
                      <label for="filterInvoice" style="font-size:12px; opacity:0.8; display:block;">Numero fattura (ADE o Gestionale)</label>
                      <input id="filterInvoice"
                            type="text"
                            placeholder="Es. 921933, 73/2025, 001234..."
                            style="min-width: 240px; padding:4px 8px; border-radius:6px; border:1px solid rgba(148,163,184,0.4); background:var(--sys-bg-shell); color:var(--sys-text-primary);">
                    </div>

                    <!-- Pulsante per azzerare i filtri -->
                    <button type="button"
                            id="btnClearFilters"
                            class="btn btn-tertiary"
                            style="font-size:12px; padding:4px 10px; margin-top:16px;">
                      ‚ü≥ Pulisci filtri
                    </button>
                  </div>
                </div>
              </div>
 
              <div class="table-wrapper" id="tableContainer" style="display:none;">
                <table id="resultTable" class="excel-table sticky-header">
                  <thead>
                    <tr class="thead-group">
                      <th colspan="7" style="text-align:center; background:var(--sys-bg-content-alt); border-bottom:1px solid var(--sys-separator);">Dati ADE</th>
                      <th colspan="6" style="text-align:center; background:var(--sys-bg-content); border-bottom:1px solid var(--sys-separator);">Dati Gestionale</th>
                      <th colspan="3" style="text-align:center; background:var(--sys-bg-content-alt); border-bottom:1px solid var(--sys-separator);">Esito</th>
                    </tr>
                    <tr class="thead-cols">
                      <th style="width: 110px;">Num</th>
                      <th style="width: 280px;">Denominazione</th>
                      <th style="width: 120px;">P.IVA</th>
                      <th style="width: 100px;">Data</th>
                      <th style="width: 100px; text-align:right;">Imp.</th>
                      <th style="width: 80px; text-align:right;">Iva</th>
                      <th style="width: 100px; text-align:right;">Totale</th>

                      <th style="width: 110px;">Num</th>
                      <th style="width: 280px;">Denominazione</th>
                      <th style="width: 100px;">Data</th>
                      <th style="width: 100px; text-align:right;">Imp.</th>
                      <th style="width: 80px; text-align:right;">Iva</th>
                      <th style="width: 100px; text-align:right;">Totale</th>

                      <th style="width: 140px;">Stato</th>
                      <th style="width: 200px;">Criterio</th>
                      <th style="width: 80px;">Azioni</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>

              <div class="footer-note">
                Puoi cliccare sulle righe con stato <strong>MATCH_FIX</strong> o <strong>SOLO GESTIONALE</strong> per correggere i dati del gestionale, oppure eliminare la parte gestionale con il cestino.
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- SEZIONE 1B: RICONCILIAZIONE VENDITE -->
      <div class="section" id="section-sales">
        <div class="main">
          <!-- SIDE COLUMN: FILE INPUTS (VENDITE) -->
          <div class="col-side">
            <!-- QUICK START GUIDE (VENDITE) -->
            <details class="card quickstart-card" open>
              <summary class="card-header quickstart-header">
                <div>
                  <div class="card-title">
                    <span class="emoji">üöÄ</span>
                    Guida rapida - Vendite
                  </div>
                </div>
              </summary>
              <div class="quickstart-body">
                <ol class="quickstart-list">
                  <li><strong>Carica i file vendite</strong> ‚Äî ADE Vendite (A) e Gestionale (B)</li>
                  <li><strong>Verifica il mapping</strong> ‚Äî Conferma colonne Cliente, Numero, Data, Importi</li>
                  <li><strong>Confronta fatture vendite</strong> ‚Äî Clicca il bottone per matchare</li>
                  <li><strong>Rivedi i risultati</strong> ‚Äî Controlla MATCH_OK e MATCH_FIX</li>
                  <li><strong>Esporta</strong> ‚Äî Scarica CSV riconciliato vendite</li>
                </ol>
                <div class="quickstart-tip">üí° <strong>Tip:</strong> Supporta cartelle multi-file (mesi/trimestri) come Acquisti</div>
              </div>
            </details>
            <div class="card">
              <div class="card-header">
                <div>
                  <div class="card-title">
                    <span class="emoji">üìÅ</span>
                    File A ¬∑ ADE Vendite
                  </div>
                  <div class="card-subtitle">CSV/XLSX export fatture vendita da portale ADE</div>
                </div>
                <div class="badge-soft">Obbligatorio</div>
              </div>
              <div class="file-block">
                <label for="salesFileAde">Seleziona il file ADE Vendite (CSV o XLSX)</label>
                <input id="salesFileAde" type="file"
                  accept=".csv,.xlsx,.xml,text/csv,text/xml,application/xml,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" />
                <div class="file-hint">üí° <strong>Multi-file:</strong> oppure seleziona una cartella con pi√π export (mesi/trimestri)</div>
                <label for="salesFolderAde">Seleziona cartella ADE Vendite (tutti i file saranno uniti)</label>
                <input id="salesFolderAde" type="file" webkitdirectory multiple accept=".csv,.xlsx,.xml" />
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <div>
                  <div class="card-title">
                    <span class="emoji">üè∑Ô∏è</span>
                    File B ¬∑ Gestionale Vendite
                  </div>
                  <div class="card-subtitle">CSV/XLSX fatture vendita (Contel / Mexal)</div>
                </div>
                <div class="badge-soft">Obbligatorio</div>
              </div>
              <div class="file-block">
                <label for="salesFileGest">Seleziona file fatture vendita</label>
                <input id="salesFileGest" type="file"
                  accept=".csv,.xlsx,.xml,text/csv,text/xml,application/xml,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" />
                <div class="file-hint">üí° <strong>Multi-file:</strong> oppure seleziona una cartella con pi√π export (mesi/trimestri)</div>
                <label for="salesFolderGest">Seleziona cartella Gestionale (tutti i file saranno uniti)</label>
                <input id="salesFolderGest" type="file" webkitdirectory multiple accept=".csv,.xlsx,.xml" />
                <button type="button" id="btnSalesForceMapB" class="btn btn-tertiary btn-force-map" title="Forza la scelta delle colonne per questo file">
                  Forza mapping colonne
                </button>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <div>
                  <div class="card-title">
                    <span class="emoji">‚Ü©Ô∏è</span>
                    File C ¬∑ Note Credito Vendite
                  </div>
                  <div class="card-subtitle">CSV/XLSX note di credito vendita da gestionale</div>
                </div>
                <div class="badge-soft">Opzionale</div>
              </div>
              <div class="file-block">
                <label for="salesFileNc">Seleziona file note credito (se disponibile)</label>
                <input id="salesFileNc" type="file"
                  accept=".csv,.xlsx,.xml,text/csv,text/xml,application/xml,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" />
                <div class="file-hint">üí° <strong>Multi-file:</strong> oppure seleziona una cartella con pi√π export (mesi/trimestri)</div>
                <label for="salesFolderNc">Seleziona cartella Note Credito (tutti i file saranno uniti)</label>
                <input id="salesFolderNc" type="file" webkitdirectory multiple accept=".csv,.xlsx,.xml" />
                <button type="button" id="btnSalesForceMapC" class="btn btn-tertiary btn-force-map" title="Forza la scelta delle colonne per questo file">
                  Forza mapping colonne
                </button>
              </div>
            </div>
          </div>

          <!-- MAIN COLUMN: ACTIONS + TABLE (VENDITE) -->
          <div class="col-main">
            <div class="card">
              <div class="flow-stepper" id="flowStepperSales">
                <div class="flow-step disabled" data-step="1">
                  <div class="flow-step-circle">1</div>
                  <div class="flow-step-text">
                    <div class="flow-step-title">Carica file vendite</div>
                    <div class="flow-step-desc">ADE Vendite (A) + Gestionale (B)</div>
                  </div>
                </div>
                <div class="flow-step disabled" data-step="2">
                  <div class="flow-step-circle">2</div>
                  <div class="flow-step-text">
                    <div class="flow-step-title">Verifica mapping</div>
                    <div class="flow-step-desc">Conferma colonne Cliente</div>
                  </div>
                </div>
                <div class="flow-step disabled" data-step="3">
                  <div class="flow-step-circle">3</div>
                  <div class="flow-step-text">
                    <div class="flow-step-title">Confronta vendite</div>
                    <div class="flow-step-desc">Match automatico</div>
                  </div>
                </div>
                <div class="flow-step disabled" data-step="4">
                  <div class="flow-step-circle">4</div>
                  <div class="flow-step-text">
                    <div class="flow-step-title">Rivedi risultati</div>
                    <div class="flow-step-desc">Verifica match</div>
                  </div>
                </div>
                <div class="flow-step disabled" data-step="5">
                  <div class="flow-step-circle">5</div>
                  <div class="flow-step-text">
                    <div class="flow-step-title">Esporta</div>
                    <div class="flow-step-desc">CSV vendite</div>
                  </div>
                </div>
              </div>

              <div class="actions-row">
                <div class="actions-left">
                  <button id="btnSalesMatch" class="btn btn-primary">
                    <span class="btn-icon">‚öôÔ∏è</span>
                    Confronta fatture vendite
                  </button>
                </div>
                <div class="actions-right">
                  <span id="salesStatusText" class="status-text">Nessun confronto eseguito.</span>
                </div>
              </div>

              <div class="summary" id="salesSummaryRow" style="display:none;">
                <div class="chip">
                  <span class="chip-dot dot-green"></span>
                  Match OK: <span id="salesCntOk">0</span>
                </div>
                <div class="chip">
                  <span class="chip-dot dot-yellow"></span>
                  Match da correggere: <span id="salesCntFix">0</span>
                </div>
                <div class="chip">
                  <span class="chip-dot dot-red"></span>
                  Solo ADE: <span id="salesCntAde">0</span>
                </div>
                <div class="chip">
                  <span class="chip-dot dot-blue"></span>
                  Solo Gestionale: <span id="salesCntGest">0</span>
                </div>
              </div>

              <div class="table-toolbar" id="salesTableToolbar" style="display:none;">
                <!-- Export buttons -->
                <div class="toolbar-section export-section">
                  <div class="export-label">Esportazioni:</div>
                  <button id="btnSalesExportVisible" class="btn btn-secondary btn-highlight" disabled title="Esporta solo le righe attualmente visibili in tabella (filtrate)">
                    <span class="btn-icon">üëÅÔ∏è</span>
                    VISTA ATTUALE (0)
                  </button>
                  <div class="vr-separator"></div>
                  <button id="btnSalesExportAll" class="btn btn-tertiary" disabled>Tutti</button>
                  <button id="btnSalesExportAde" class="btn btn-tertiary" disabled>Solo ADE</button>
                  <button id="btnSalesExportGest" class="btn btn-tertiary" disabled>Solo Gest</button>
                  <button id="btnSalesExportFix" class="btn btn-tertiary" disabled>Solo Fix</button>
                </div>

                <!-- Filtri stato -->
                <div class="toolbar-section filter-section">
                  <div class="filter-row" id="salesFilterRow">
                    <button class="filter-btn active" id="salesFilterAll" data-filter="ALL">Tutti</button>
                    <button class="filter-btn" id="salesFilterOk" data-filter="MATCH_OK">Match OK</button>
                    <button class="filter-btn" id="salesFilterFix" data-filter="MATCH_FIX">Da correggere</button>
                    <button class="filter-btn" id="salesFilterOnlyAde" data-filter="SOLO_ADE">Solo ADE</button>
                    <button class="filter-btn" id="salesFilterOnlyGest" data-filter="SOLO_GEST">Solo Gestionale</button>
                  </div>
                </div>

                <!-- Filtri avanzati -->
                <div class="toolbar-section advanced-filter-section">
                  <div class="advanced-filter-row" id="salesAdvancedFilterRow">
                    <div style="font-size:12px; opacity:0.8;">Filtri aggiuntivi:</div>

                    <!-- Filtro mese ADE -->
                    <div>
                      <label for="salesMonthFilter" style="font-size:12px; opacity:0.8; display:block;">Mese (data ADE)</label>
                      <select id="salesMonthFilter" style="min-width: 200px; padding:4px 8px; border-radius:6px; border:1px solid rgba(148,163,184,0.4); background:var(--sys-bg-shell); color:var(--sys-text-primary);">
                        <option value="">Tutti i mesi ADE</option>
                      </select>
                    </div>

                    <!-- Filtro cliente -->
                    <div>
                      <label for="salesPartyFilter" style="font-size:12px; opacity:0.8; display:block;">Cliente (denominazione o P.IVA)</label>
                      <input id="salesPartyFilter"
                            type="text"
                            placeholder="Es. ROSSI SRL, 1337820152..."
                            style="min-width: 240px; padding:4px 8px; border-radius:6px; border:1px solid rgba(148,163,184,0.4); background:var(--sys-bg-shell); color:var(--sys-text-primary);">
                    </div>

                    <!-- Filtro numero fattura -->
                    <div>
                      <label for="salesNumFilter" style="font-size:12px; opacity:0.8; display:block;">Numero fattura (ADE o Gestionale)</label>
                      <input id="salesNumFilter"
                            type="text"
                            placeholder="Es. 921933, 73/2025, 001234..."
                            style="min-width: 240px; padding:4px 8px; border-radius:6px; border:1px solid rgba(148,163,184,0.4); background:var(--sys-bg-shell); color:var(--sys-text-primary);">
                    </div>

                    <!-- Pulsante per azzerare i filtri -->
                    <button type="button"
                            id="btnSalesClearFilters"
                            class="btn btn-tertiary"
                            style="font-size:12px; padding:4px 10px; margin-top:16px;">
                      ‚ü≥ Pulisci filtri
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <div class="table-card">
              <div class="table-header">
                <div>
                  <div class="table-title">Risultato riconciliazione vendite</div>
                  <div class="table-subtitle">Vista combinata ADE Vendite / Gestionale</div>
                </div>
              </div>

              <div class="table-wrapper" id="salesTableContainer" style="display:none;">
                <table id="salesResultTable" class="excel-table sticky-header">
                  <thead>
                    <tr class="thead-group">
                      <th colspan="7" style="text-align:center; background:var(--sys-bg-content-alt); border-bottom:1px solid var(--sys-separator);">Dati ADE</th>
                      <th colspan="6" style="text-align:center; background:var(--sys-bg-content); border-bottom:1px solid var(--sys-separator);">Dati Gestionale</th>
                      <th colspan="2" style="text-align:center; background:var(--sys-bg-content-alt); border-bottom:1px solid var(--sys-separator);">Esito</th>
                    </tr>
                    <tr class="thead-cols">
                      <th style="width: 110px;">Num</th>
                      <th style="width: 280px;">Cliente</th>
                      <th style="width: 120px;">P.IVA</th>
                      <th style="width: 100px;">Data</th>
                      <th style="width: 100px; text-align:right;">Imp.</th>
                      <th style="width: 80px; text-align:right;">Iva</th>
                      <th style="width: 100px; text-align:right;">Totale</th>

                      <th style="width: 110px;">Num</th>
                      <th style="width: 280px;">Cliente</th>
                      <th style="width: 100px;">Data</th>
                      <th style="width: 100px; text-align:right;">Imp.</th>
                      <th style="width: 80px; text-align:right;">Iva</th>
                      <th style="width: 100px; text-align:right;">Totale</th>

                      <th style="width: 140px;">Stato</th>
                      <th style="width: 200px;">Criterio</th>
                    </tr>
                  </thead>
                  <tbody id="salesResultsTbody"></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- SEZIONE 2: ANALISI FORNITORI -->
      <div class="section" id="section-analysis">
        <div class="analysis-wrapper">
          <div class="analysis-header">
            <div class="analysis-title">Analisi fornitori (da ADE)</div>
            <div class="analysis-subtitle">
              Pesa i fornitori in base alle fatture presenti in ADE, su un periodo di analisi selezionato.
            </div>
          </div>

          <div class="analysis-filters">
            <div class="analysis-period-row">
              <span>Periodo di analisi:</span>
              <div>
                <label for="anStart">Dal</label>
                <input type="date" id="anStart" />
              </div>
              <div>
                <label for="anEnd">Al</label>
                <input type="date" id="anEnd" />
              </div>
              <div class="analysis-period-quick">
                <button type="button" class="pill-small" id="btnAnAll">Tutto ADE</button>
                <button type="button" class="pill-small" id="btnAnYear">Anno corrente</button>
                <button type="button" class="pill-small" id="btnAnLast12">Ultimi 12 mesi</button>
              </div>
            </div>

            <div class="analysis-actions-row">
              <button type="button" class="btn btn-secondary" id="btnAnApply">
                Applica filtro periodo
              </button>
              <span id="analysisStatus" class="analysis-status">
                In attesa dati ADE: carica il file nella sezione Riconciliazione.
              </span>
            </div>

            <div class="analysis-search-row">
              <input type="text" id="anSearch" placeholder="Cerca fornitore o P.IVA..." />
              <span id="analysisCount" class="analysis-count">Fornitori nel periodo: 0</span>
            </div>
          </div>

          <div class="analysis-table-card">
            <div class="analysis-table-header">
              <div>
                <div class="table-title">Elenco fornitori ADE</div>
                <div class="table-subtitle">
                  Ordinati per totale complessivo (imponibile + IVA) in ordine decrescente.
                </div>
              </div>
            </div>

            <div class="table-wrapper" id="analysisTableContainer" style="display:none;">
              <table id="analysisTable">
                <thead>
                  <tr>
                    <th style="width: 250px;">Fornitore<div class="resizer"></div></th>
                    <th style="width: 130px;">P.IVA<div class="resizer"></div></th>
                    <th style="width: 150px;">Tot. imponibile<div class="resizer"></div></th>
                    <th style="width: 150px;">Tot. IVA<div class="resizer"></div></th>
                    <th style="width: 150px;">Tot. complessivo<div class="resizer"></div></th>
                    <th style="width: 100px;">N. fatture<div class="resizer"></div></th>
                    <th style="width: 200px;">Periodo<div class="resizer"></div></th>
                  </tr>
                </thead>
                <tbody id="analysisTbody"></tbody>
              </table>
            </div>

            <div class="analysis-footer-note">
              L‚Äôanalisi utilizza solo i dati del file ADE (fatture acquisto) nel periodo selezionato.
            </div>
          </div>
        </div>
      </div>

            <!-- SEZIONE 3: DASHBOARD / KPI -->
<div class="section" id="section-dashboard">
  <div class="analysis-wrapper">
    <div class="analysis-header">
      <div class="analysis-title">Dashboard allineamento periodi</div>
      <div class="analysis-subtitle">
        Stato mensile di allineamento tra fatture ADE e registrazioni in gestionale.
      </div>
    </div>

            <!-- Riepilogo sintetico sopra la tabella -->
            <p id="kpiPeriodSummary"
               class="analysis-status"
               style="margin: 8px 0 12px;">
              Esegui un confronto fatture per vedere lo stato di allineamento mensile.
            </p>

            <div class="table-wrapper" id="kpiPeriodTableContainer" style="display:block;">
              <table id="kpiPeriodTable">
                <thead>
                  <tr>
                    <th style="width: 150px;">Mese<div class="resizer"></div></th>
                    <th class="mono" style="width: 120px;">Fatture ADE<div class="resizer"></div></th>
                    <th class="mono" style="width: 120px;">Match OK<div class="resizer"></div></th>
                    <th class="mono" style="width: 120px;">Match da correggere<div class="resizer"></div></th>
                    <th class="mono" style="width: 120px;">Solo ADE<div class="resizer"></div></th>
                    <th class="mono" style="width: 120px;">Solo Gest.<div class="resizer"></div></th>
                    <th style="width: 200px;">Stato<div class="resizer"></div></th>
                  </tr>
                </thead>
                <tbody id="kpiPeriodTbody">
                  <!-- riempito da logic.js -->
                </tbody>
              </table>
            </div>

            <div class="analysis-footer-note">
              Lo stato di ogni mese √® calcolato sulle righe ADE del risultato di riconciliazione
              (MATCH OK, MATCH_FIX, SOLO ADE, SOLO GEST).
            </div>
          </div>
        </div>
      </div>

      <!-- SEZIONE 4: LIQUIDAZIONE IVA -->
      <div class="section" id="section-vat">
        <div class="analysis-wrapper">
          <div class="analysis-header">
            <div class="analysis-title">Liquidazione IVA Mensile</div>
            <div class="analysis-subtitle">
              Calcolo IVA a credito (acquisti) e IVA a debito (vendite) con saldo mensile.
            </div>
          </div>

          <!-- Processo guidato step-by-step -->
          <div class="vat-process-guide">
            <div class="vat-step">
              <div class="vat-step-number">1</div>
              <div class="vat-step-content">
                <strong>Carica ADE Acquisti</strong>
                <span class="vat-step-status" id="vatStepAcq">‚è≥ Attendere</span>
              </div>
            </div>
            <div class="vat-step">
              <div class="vat-step-number">2</div>
              <div class="vat-step-content">
                <strong>Carica ADE Vendite</strong> (opzionale per liquidazione completa)
                <span class="vat-step-status" id="vatStepVen">‚è≥ Attendere</span>
              </div>
            </div>
            <div class="vat-step">
              <div class="vat-step-number">3</div>
              <div class="vat-step-content">
                <strong>Scegli regola data IVA</strong>
                <span class="vat-step-status" id="vatStepDate">‚öôÔ∏è Configurabile sotto</span>
              </div>
            </div>
            <div class="vat-step">
              <div class="vat-step-number">4</div>
              <div class="vat-step-content">
                <strong>Verifica mesi con warning</strong>
                <span class="vat-step-status" id="vatStepWarn">üìä Automatico</span>
              </div>
            </div>
            <div class="vat-step">
              <div class="vat-step-number">5</div>
              <div class="vat-step-content">
                <strong>Esporta prospetto</strong>
                <span class="vat-step-status" id="vatStepExp">üì• Pronto</span>
              </div>
            </div>
          </div>

          <!-- Toggle modalit√† -->
          <div class="vat-mode-toggle">
            <label>
              <input type="radio" name="vatMode" value="acquisti" checked id="vatModeAcquisti" />
              <span>Solo ADE Acquisti (IVA a credito)</span>
            </label>
            <label>
              <input type="radio" name="vatMode" value="completa" id="vatModeCompleta" />
              <span>Liquidazione completa (Acquisti + Vendite)</span>
            </label>
          </div>

          <div class="kpi-container" id="vatKpiContainer">
              <div class="kpi-box">
                  <div class="kpi-label">IVA a Credito (Acquisti)</div>
                  <div class="kpi-value" id="vatCredito">‚Ç¨ 0,00</div>
              </div>
              <div class="kpi-box" style="border-color: #ef4444;">
                  <div class="kpi-label">IVA a Debito (Vendite)</div>
                  <div class="kpi-value" id="vatDebito">‚Ç¨ 0,00</div>
              </div>
              <div class="kpi-box" style="border-color: #10b981;">
                  <div class="kpi-label">Saldo IVA Mensile</div>
                  <div class="kpi-value" id="vatSaldo">‚Ç¨ 0,00</div>
              </div>
          </div>

          <!-- KPI vecchi (solo acquisti) - nascosti in modalit√† completa -->
          <div class="kpi-container" id="vatKpiContainerOld" style="display:none;">
              <div class="kpi-box">
                  <div class="kpi-label">Totale Imponibile</div>
                  <div class="kpi-value" id="vatTotImp">‚Ç¨ 0,00</div>
              </div>
              <div class="kpi-box" style="border-color: #ef4444;">
                  <div class="kpi-label">Totale IVA</div>
                  <div class="kpi-value" id="vatTotIva">‚Ç¨ 0,00</div>
              </div>
              <div class="kpi-box" style="border-color: #10b981;">
                  <div class="kpi-label">Valore Totale Documenti</div>
                  <div class="kpi-value" id="vatTotDoc">‚Ç¨ 0,00</div>
              </div>
          </div>

          <div class="analysis-table-card">
            <div class="analysis-table-header">
              <div>
                <div class="table-title">Dettaglio Mensile</div>
              </div>
              <div class="vat-controls" style="display:flex; gap:14px; align-items:center; flex-wrap:wrap; margin-top:6px;">
                <label style="display:flex; gap:8px; align-items:center; font-size:0.85rem;">
                  Data per IVA:
                  <select id="vatDateBasis">
                    <option value="RICEZIONE">Data ricezione</option>
                    <option value="EMISSIONE">Data emissione</option>
                    <option value="AUTO">Auto (ricezione‚Üíemissione)</option>
                  </select>
                </label>

                <label style="display:flex; gap:8px; align-items:center; font-size:0.85rem;">
                  <input type="checkbox" id="vatIncludePrevYear" />
                  Includi anche anno precedente
                </label>
                
                <label style="display:flex; gap:8px; align-items:center; font-size:0.85rem;">
                  <input type="checkbox" id="chkShowClosedMonths" checked />
                  Mostra mesi chiusi
                </label>
              </div>

              <div style="display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-top:8px;">
                <label style="display:flex; gap:8px; align-items:center; font-size:0.85rem;">
                  Riporto iniziale (credito - / debito +):
                  <input type="number" id="vatOpeningBalance" step="0.01" value="0" style="width:120px; padding:6px 8px; border-radius:8px; border:1px solid rgba(120,144,180,0.35); background:rgba(255,255,255,0.03); color:inherit;" />
                </label>
                
                <button id="btnVatResetPayments" class="btn btn-tertiary" title="Azzera tutti i versamenti F24">
                  üîÑ Reset versamenti
                </button>
              </div>

              <button id="btnExportVat" class="btn btn-tertiary btn-icon-only" title="Esporta prospetto IVA">
                 üì• Esporta CSV
              </button>
            </div>

            <div class="table-wrapper" style="display:block;">
              <table id="vatTable">
                <thead id="vatTableHead">
                  <!-- Header per modalit√† "Solo Acquisti" (default) -->
                  <tr id="vatHeaderAcquisti">
                    <th style="width: 150px;">Periodo (Mese)<div class="resizer"></div></th>
                    <th style="width: 100px;">N. Fatture<div class="resizer"></div></th>
                    <th style="text-align:right; width: 150px;">Imponibile<div class="resizer"></div></th>
                    <th style="text-align:right; width: 150px;">IVA<div class="resizer"></div></th>
                    <th style="text-align:right; width: 150px;">Totale Fattura<div class="resizer"></div></th>
                  </tr>
                  <!-- Header per modalit√† "Completa" (nascosto di default) -->
                  <tr id="vatHeaderCompleta" style="display:none;">
                    <th style="width: 150px;">Periodo (Mese)<div class="resizer"></div></th>
                    <th style="text-align:right; width: 130px;">IVA Credito (Acq)<div class="resizer"></div></th>
                    <th style="text-align:right; width: 130px;">IVA Debito (Ven)<div class="resizer"></div></th>
                    <th style="text-align:right; width: 130px;">Saldo IVA<div class="resizer"></div></th>
                    <th style="text-align:right; width: 130px;">Riporto da prec.<div class="resizer"></div></th>
                    <th style="text-align:right; width: 130px;">Posizione prima F24<div class="resizer"></div></th>
                    <th style="text-align:center; width: 140px;">F24 versato<div class="resizer"></div></th>
                    <th style="text-align:right; width: 130px;">Residuo<div class="resizer"></div></th>
                    <th style="text-align:center; width: 100px;">Chiusa<div class="resizer"></div></th>
                    <th style="text-align:center; width: 100px;">N. Doc Acq<div class="resizer"></div></th>
                    <th style="text-align:center; width: 100px;">N. Doc Ven<div class="resizer"></div></th>
                  </tr>
                </thead>
                <tbody id="vatTbody">
                  </tbody>
              </table>
            </div>
            
            <div class="analysis-footer-note">
              Attenzione: I dati si basano sulla data documento presente nel file ADE, non sulla data di competenza/detrazione effettiva.
            </div>
          </div>
        </div>
      </div>

        <!-- Popup mapping colonne GESTIONALE -->
<div id="gestMapBackdrop" class="modal-backdrop hidden">
  <div class="modal-panel">
    <h3 id="gestMapTitle">Aggancio colonne (File B / File C)</h3>
    <p>
      Seleziona per ogni campo ContAIbil la colonna corretta del file
      (Mexal/Contel). Puoi salvarla nelle procedure cos√¨ non dovrai rifarlo ogni volta.
    </p>
    <div id="gestMapHelper" class="mapping-helper-text">Obbligatori: Numero documento, Data, Totale oppure (Imponibile + IVA).</div>

    <div class="form-grid">
      <div>
        <label for="selGestNum">
          Numero fattura / documento<br />
          <select id="selGestNum"></select>
        </label>
      </div>

      <div>
        <label for="selGestPiva">
          Partita IVA fornitore<br />
          <select id="selGestPiva"></select>
        </label>
      </div>

      <div>
        <label for="selGestDen">
          Denominazione fornitore<br />
          <select id="selGestDen"></select>
        </label>
      </div>

      <div>
        <label for="selGestData">
          Data DOCUMENTO (per il match)<br />
          <select id="selGestData"></select>
        </label>
      </div>

      <div>
        <label for="selGestDataReg">
          Data REGISTRAZIONE (per IVA/Filtri)<br />
          <select id="selGestDataReg"></select>
        </label>
      </div>

      <div>
        <label for="selGestImp">
          Imponibile<br />
          <select id="selGestImp"></select>
        </label>
      </div>

      <div>
        <label for="selGestIva">
          IVA<br />
          <select id="selGestIva"></select>
        </label>
      </div>

      <div>
        <label for="selGestTot">
          Totale documento<br />
          <select id="selGestTot"></select>
        </label>
      </div>
    </div>

    <div class="modal-actions">
      <button type="button" id="btnGestMapCancel">Annulla</button>
      <button type="button" id="btnGestMapOk" class="primary">
        Usa queste colonne
      </button>
    </div>
  </div>
</div>

    <!-- EDIT PANEL (MODIFICA MATCH) -->
    <div id="editPanelBackdrop" class="edit-backdrop hidden">
      <div id="editPanel" class="edit-panel">
        <div class="edit-header">
          <div>
            <div class="edit-title">Modifica riga match</div>
            <div class="edit-subtitle" id="editRowInfo">Seleziona una riga MATCH_FIX o SOLO GESTIONALE dalla tabella.</div>
          </div>
          <button type="button" id="editCloseBtn" class="edit-close-btn">‚úï</button>
        </div>
        
        <div id="editPanelContent">
          <div class="edit-section">
            <div class="edit-section-title">Dati ADE (sola lettura)</div>
            <div class="edit-grid">
              <div class="edit-field">
                <label>Numero fattura</label>
                <div class="edit-read" id="editAdeNum"></div>
              </div>
              <div class="edit-field">
                <label>Denominazione</label>
                <div class="edit-read" id="editAdeDen"></div>
              </div>
              <div class="edit-field">
                <label>P.IVA</label>
                <div class="edit-read" id="editAdePiva"></div>
              </div>
              <div class="edit-field">
                <label>Data</label>
                <div class="edit-read" id="editAdeData"></div>
              </div>
              <div class="edit-field">
                <label>Imponibile / IVA / Totale</label>
                <div class="edit-read" id="editAdeImpIvaTot"></div>
              </div>
            </div>
          </div>

          <div class="edit-section" id="editGestSection">
            <div class="edit-section-title">Dati Gestionale (modificabili)</div>
            <div class="edit-grid">
              <div class="edit-field">
                <label>Numero documento</label>
                <input id="editGestNum" class="edit-input" type="text" />
              </div>
              <div class="edit-field">
                <label>Denominazione conto / fornitore</label>
                <input id="editGestDen" class="edit-input" type="text" />
              </div>
              <div class="edit-field">
                <label>Data</label>
                <input id="editGestData" class="edit-input" type="text" placeholder="es. 31/03/2025" />
              </div>
              <div class="edit-field">
                <label>Imponibile</label>
                <input id="editGestImp" class="edit-input" type="text" placeholder="es. 1000,00" />
              </div>
              <div class="edit-field">
                <label>IVA</label>
                <input id="editGestIva" class="edit-input" type="text" placeholder="es. 220,00" />
              </div>
              <div class="edit-field">
                <label>Totale</label>
                <input id="editGestTot" class="edit-input" type="text" placeholder="es. 1220,00" />
              </div>
            </div>
          </div>

          <div class="editor-group">
            <label for="editStatus">Stato:</label>
            <select id="editStatus" class="editor-input">
              <option value="MATCH_OK">MATCH OK</option>
              <option value="MATCH_FIX">MATCH DA CORREGGERE</option>
              <option value="SOLO_ADE">SOLO ADE</option>
              <option value="SOLO_GEST">SOLO GESTIONALE</option>
            </select>
          </div>

          <div class="edit-matchcode-box" style="margin-top: 20px;">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
    <label style="font-weight: bold; margin: 0;" class="edit-matchcode-title">
      Report Diagnostico &amp; Note:
    </label>

    <div style="display: flex; gap: 6px; align-items: center;">
      <!-- ‚úÖ NUOVO BOTTONE MASSIVO PER FORNITORE -->
      <button
        id="editBulkOkSupplier"
        type="button"
        class="btn btn-secondary"
        style="padding: 2px 8px; font-size: 11px; white-space: nowrap;"
      >
        ‚úÖ Conferma tutti i match di questo fornitore
      </button>

      <!-- Bottone copia report gi√† esistente -->
      <button
        id="btnCopyReport"
        type="button"
        class="btn btn-secondary"
        style="padding: 2px 8px; font-size: 11px;"
      >
        üìã COPIA PER AI
      </button>
    </div>
  </div>

  <textarea
    id="editMatchNote"
    placeholder="Il report diagnostico apparir√† qui quando apri una riga gialla (MATCH_FIX)..."
    spellcheck="false"
  ></textarea>
</div>

        <div class="edit-actions">
          <button type="button" id="editSaveBtn" class="btn btn-primary">Salva modifiche</button>
          <button type="button" id="editDeleteGestBtn" class="btn btn-danger">Elimina parte Gestionale</button>
          <button type="button" id="editCancelBtn" class="btn btn-ghost">Annulla</button>
        </div>
      </div>
    </div>
  </div>

    <!-- Libreria per leggere XLSX -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <!-- Script principale -->
  <script src="logic.js"></script>

</body>
</html>
